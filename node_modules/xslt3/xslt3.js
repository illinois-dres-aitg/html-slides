#!/usr/bin/env node
 (function(){var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
var CommandLine$$module$temp$js$source$nodeJS$commandLineOptions=function(){var a={TYPE_BOOLEAN:1,TYPE_FILENAME:2,TYPE_CLASSNAME:3,TYPE_ENUMERATION:4,TYPE_INTEGER:5,TYPE_QNAME:6,TYPE_FILENAME_LIST:7,TYPE_DATETIME:8,TYPE_STRING:9,TYPE_INTEGER_PAIR:10,VALUE_REQUIRED:256,VALUE_PROHIBITED:512},b=["on","yes","true","1"],c=["off","no","false","0"],g={TYPE_BOOLEAN:b.concat(c).join("|"),TYPE_FILENAME:"file name",TYPE_CLASSNAME:"Java fully-qualified class name",TYPE_ENUMERATION:4,TYPE_INTEGER:"integer",TYPE_QNAME:"QName in URI qualified name form (Q{uri}local)",
TYPE_FILENAME_LIST:"list of file names, semicolon-separated",TYPE_DATETIME:"dateTime in ??? format",TYPE_STRING:"string",TYPE_INTEGER_PAIR:"int,int"},d;for(d in a)g[a[d]]=g[d];var f=function(){this._recognized={};this.actualOptions={};this.extraOptions={}};f.prototype.addRecognizedOption=function(a,b,c){this._recognized[a]={type:b&255,required:b&768,help:c}};f.prototype.setPermittedValues=function(a,b,c){var k=this._recognized[a];k?(k.values=b,k.defaultValue=c):console.log("setPermittedValues - no record yet for option:",
a)};f.prototype.displayPermittedOptions=function(){var a=[],b;for(b in this._recognized)a.push(b);a.sort(function(a,b){a=a.toLowerCase();b=b.toLowerCase();return a<b?-1:a===b?0:1});a=a.map(function(a){return" -"+a});return a.join()};f.prototype.setActualOptions=function(a){function d(a,b){throw Error("Command line option -"+a+" "+b);}var k=this._recognized,f=this.actualOptions,n=this.extraOptions;a.filter(function(a){return a.startsWith("-")}).forEach(function(a){var e=a.indexOf(":"),h=0>e?a.substring(1):
a.substring(1,e);e=0>e?"":a.substring(e+1);if(a.startsWith("--"))n[h.substring(1)]=e;else{(a=k[h])||d(h,"is not recognized");if("?"===e)throw h="Help for -"+h+" option:"+("\nValue:   "+(4==a.type?a.values.join("|"):g[a.type])),h+="\nMeaning: "+a.help,Error(h+"\n\nNo processing requested");256===a.required&&""===e&&d(h,"requires a value");512===a.required&&""!==e&&d(h,"must not have a value");""===e&&(e=a.defaultValue||"");switch(a.type){case 4:e&&-1===a.values.indexOf(e)&&d(h,"may only have values "+
a.values.join("|"));break;case 5:/[0-9]+/.test(e)||d(h,"may only have value "+g.TYPE_INTEGER);e=parseInt(e,10);break;case 1:0<=b.indexOf(e)?e=!0:0<=c.indexOf(e)?e=!1:""===e?e=!0:d(h,"may only have a boolean value "+g.TYPE_BOOLEAN);break;case 6:/{/.test(e)||/}/.test(e)||(e="Q{}"+e),/^Q{[^{}]*}[^{}]+$/.test(e)||d(h,"may only have value "+g.TYPE_QNAME)}f[h]=e}})};return{OptionTypes:a,newCLOptions:function(){var b=new f;b.addRecognizedOption("co",a.TYPE_ENUMERATION|a.VALUE_REQUIRED,"Set compiler option");
b.setPermittedValues("co","justStatic justNormalize noXPath noBindings timing traceProgress enableAssertions internalCompile".split(" "),null);b.addRecognizedOption("tp",a.TYPE_BOOLEAN,"Trace compiler progress");b.addRecognizedOption("debug",a.TYPE_BOOLEAN,"Use diagnostic version of Saxon-JS 2");b.addRecognizedOption("export",a.TYPE_FILENAME|a.VALUE_REQUIRED,"Export the compiled stylesheet");b.addRecognizedOption("im",a.TYPE_QNAME|a.VALUE_REQUIRED,"Name of initial mode");b.addRecognizedOption("it",
a.TYPE_QNAME,"Name of initial template");b.setPermittedValues("it",[],"Q{http://www.w3.org/1999/XSL/Transform}initial-template");b.addRecognizedOption("master",a.TYPE_FILENAME|a.VALUE_REQUIRED,"Master document for in-situ update");b.addRecognizedOption("nogo",a.TYPE_BOOLEAN,"Compile only, no evaluation");b.addRecognizedOption("ns",a.TYPE_ENUMERATION|a.VALUE_REQUIRED,"Default namespace for element names");b.setPermittedValues("ns",["##html5"],null);b.addRecognizedOption("o",a.TYPE_FILENAME|a.VALUE_REQUIRED,
"Destination file for primary output");b.addRecognizedOption("s",a.TYPE_FILENAME|a.VALUE_REQUIRED,"Source file for primary input");b.addRecognizedOption("t",a.TYPE_BOOLEAN,"Display version and timing information, and names of output files");b.addRecognizedOption("xsl",a.TYPE_FILENAME|a.VALUE_REQUIRED,"Main stylesheet file (XSLT or SEF)");b.addRecognizedOption("?",a.TYPE_BOOLEAN|a.VALUE_PROHIBITED,"Display command line help text");return b}}}(),module$temp$js$source$nodeJS$commandLineOptions={};
module$temp$js$source$nodeJS$commandLineOptions.CommandLine=CommandLine$$module$temp$js$source$nodeJS$commandLineOptions;var argv$$module$temp$js$source$nodeJS$command=process.argv,finished$$module$temp$js$source$nodeJS$command=!1,exitCode$$module$temp$js$source$nodeJS$command=0,failed$$module$temp$js$source$nodeJS$command=!1;function exit$$module$temp$js$source$nodeJS$command(a){a=void 0===a?0:a;finished$$module$temp$js$source$nodeJS$command=!0;a>exitCode$$module$temp$js$source$nodeJS$command&&(exitCode$$module$temp$js$source$nodeJS$command=a,process.exitCode=a)}
function quit$$module$temp$js$source$nodeJS$command(a,b){b=void 0===b?0:b;console.error(a);failed$$module$temp$js$source$nodeJS$command=!0;exit$$module$temp$js$source$nodeJS$command(b)}function log$$module$temp$js$source$nodeJS$command(a){platform$$module$temp$js$source$nodeJS$command.saxonPrint(a)}function warn$$module$temp$js$source$nodeJS$command(a){log$$module$temp$js$source$nodeJS$command("*Warning*: "+a)}
SaxonJS=require(argv$$module$temp$js$source$nodeJS$command.includes("-debug")?"./SaxonJS2N.debug":"saxon-js");var fs$$module$temp$js$source$nodeJS$command=require("fs"),$jscomp$destructuring$var0=require("url"),URL$$module$temp$js$source$nodeJS$command=$jscomp$destructuring$var0.URL,platform$$module$temp$js$source$nodeJS$command=SaxonJS.getPlatform(),thisProgram$$module$temp$js$source$nodeJS$command=filepathToUri$$module$temp$js$source$nodeJS$command(argv$$module$temp$js$source$nodeJS$command[1]);
platform$$module$temp$js$source$nodeJS$command.setBaseUri(thisProgram$$module$temp$js$source$nodeJS$command);
function getParams$$module$temp$js$source$nodeJS$command(a){var b=new SaxonJS.XdmMap;a.filter(function(a){return!/^[-!]/.test(a)}).forEach(function(a){var c=a.split("="),d=$jscomp.makeIterator(c),f=d.next().value;d=d.next().value;1===c.length&&quit$$module$temp$js$source$nodeJS$command("Missing '=' in parameter '"+a+"'",2);switch(f.charAt(0)){case "?":f=f.slice(1);try{d=SaxonJS.XPath.evaluate(d,null,{resultForm:"xdm"})}catch(k){throw k;}break;case "+":f=f.slice(1);d=getPathToFile$$module$temp$js$source$nodeJS$command(d);
fs$$module$temp$js$source$nodeJS$command.statSync(d).isDirectory()?quit$$module$temp$js$source$nodeJS$command(d+" is a directory",2):d=[getXML$$module$temp$js$source$nodeJS$command(d)];break;default:d=[SaxonJS.XS.untypedAtomic.fromString(d)]}/{/.test(f)||/}/.test(f)||(f="Q{}"+f);/^Q{[^{}]*}[^{}]+$/.test(f)||quit$$module$temp$js$source$nodeJS$command("Invalid parameter key "+f,2);b.inSituPut(SaxonJS.XS.QName.fromEQName(f),d)});return b}
function getSerializationParams$$module$temp$js$source$nodeJS$command(a){var b={};a.filter(function(a){return a.startsWith("!")}).forEach(function(a){a=a.split(/=/);var c=$jscomp.makeIterator(a);a=c.next().value;c=c.next().value;a=a.slice(1).replace(/^saxon:/,"Q{http://saxon.sf.net/}");b[a]=SaxonJS.Serializer.validateParam(a,c)});return b}
function addParentPointers$$module$temp$js$source$nodeJS$command(a){a.C&&a.C.forEach(function(b){b.parentNode=a;addParentPointers$$module$temp$js$source$nodeJS$command(b)})}
function checksum$$module$temp$js$source$nodeJS$command(a){function b(a,b){for(var d=b<<8,e=0;e<a.length;e++)d=(d<<1)+a.charCodeAt(e);return d}function c(a,d,c){return b(a,c)^b(d,c)}function g(a){d^=c(a.N,"http://ns.saxonica.com/xslt/export",f++);for(var e in a)a.hasOwnProperty(e)&&"N"!==e&&"C"!==e&&e!==String.fromCharCode(931)&&(d^=c(e,"",f),d^=b(a[e],f));a.C&&a.C.forEach(function(a){g(a)});d^=1}var d=0,f=0;g(a);a[String.fromCharCode(931)]=(0>d?4294967295+d+1:d).toString(16)}
function TransformOptions$$module$temp$js$source$nodeJS$command(){}TransformOptions$$module$temp$js$source$nodeJS$command.prototype={stylesheetParams:{},templateParams:{},tunnelParams:{},functionParams:{},deliverResultDocument:void 0};
function invokeSEFTransform$$module$temp$js$source$nodeJS$command(a,b,c){var g=SaxonJS.checkOptions(c);g.async=!0;c=Promise.resolve(null);b&&(c=c.then(function(){return platform$$module$temp$js$source$nodeJS$command.resourcePromise({file:b})})["catch"](function(a){console.error(a);throw a;}).then(function(a){return new Promise(function(d,c){var e=platform$$module$temp$js$source$nodeJS$command.parseXmlFromString(a.toString(),!0);e._saxonBaseUri=filepathToUri$$module$temp$js$source$nodeJS$command(getPathToFile$$module$temp$js$source$nodeJS$command(b));
return d(e)})})["catch"](function(a){console.error(a);throw a;}));return c=c.then(function(b){SaxonJS.internalTransform(a,b,g);return g.resultPromise})}
function compileXSLT$$module$temp$js$source$nodeJS$command(a,b,c){var g=new TransformOptions$$module$temp$js$source$nodeJS$command;g.destination="application";g.initialMode="compile-complete";g.templateParams={"Q{}options":{noXPath:!1}};for(var d in b)b.hasOwnProperty(d)&&(g.templateParams["Q{}options"][d]=b[d]);g.stylesheetParams=new SaxonJS.XdmMap;g.stylesheetParams.inSituPut(SaxonJS.XS.QName.fromParts("","","staticParameters"),[c]);b=platform$$module$temp$js$source$nodeJS$command.resource("compiler");
addParentPointers$$module$temp$js$source$nodeJS$command(b);return invokeSEFTransform$$module$temp$js$source$nodeJS$command(b,a,g).then(function(a){return Promise.resolve(a.principalResult)})}function getXML$$module$temp$js$source$nodeJS$command(a){var b=platform$$module$temp$js$source$nodeJS$command.parseXmlFromString(readFile$$module$temp$js$source$nodeJS$command(a));b._saxonBaseUri=filepathToUri$$module$temp$js$source$nodeJS$command(a);return b}
function readFile$$module$temp$js$source$nodeJS$command(a){try{return fs$$module$temp$js$source$nodeJS$command.readFileSync(a,"utf8")}catch(b){quit$$module$temp$js$source$nodeJS$command("Unable to read "+a,2)}}function getPathToFile$$module$temp$js$source$nodeJS$command(a){return fs$$module$temp$js$source$nodeJS$command.realpathSync(a)}function filepathToUri$$module$temp$js$source$nodeJS$command(a){return platform$$module$temp$js$source$nodeJS$command.fileURL(a)}
function compile$$module$temp$js$source$nodeJS$command(a,b,c,g,d){try{var f=getPathToFile$$module$temp$js$source$nodeJS$command(a.xsl)}catch(h){var k=h.message.replace("ENOENT: no such file or directory, lstat ","");return Promise.reject(new SaxonJS.XError("Cannot locate stylesheet ("+k+")"))}var e;if(f.endsWith(".sef")||f.endsWith(".sef.json"))return c.stylesheetFileName=f,new Promise(function(a,b){a(c)});if(f.endsWith(".sef.xml")){a=getXML$$module$temp$js$source$nodeJS$command(f);try{k=SaxonJS.XPath.sefToJSON(a.firstChild,
!1)}catch(h){return Promise.reject(Error("Internal error: the intermediate XML form of the SEF file is invalid: "+h.message))}checksum$$module$temp$js$source$nodeJS$command(k);c.stylesheetText=JSON.stringify(k);return new Promise(function(a,b){a(c)})}a.t&&console.error("Compiling stylesheet "+f);return compileXSLT$$module$temp$js$source$nodeJS$command(f,b,g)["catch"](function(a){console.error("Failed to compile stylesheet: "+a.message);a instanceof SaxonJS.XError&&(a.message="Failed to compile stylesheet\n"+
a.getMessage());throw a;}).then(function(a){Array.isArray(a)&&(a=a[0]);try{var b=SaxonJS.XPath.sefToJSON(a.firstChild,!1)}catch(n){return Promise.reject(Error("Internal error: the intermediate XML form of the SEF file is invalid: "+n.message))}checksum$$module$temp$js$source$nodeJS$command(b);c.stylesheetText=JSON.stringify(b);e=filepathToUri$$module$temp$js$source$nodeJS$command(getPathToFile$$module$temp$js$source$nodeJS$command(f));c.stylesheetFileName=e;return new Promise(function(a,b){a(c)})})}
function executeTransformation$$module$temp$js$source$nodeJS$command(a,b,c){try{var g=process.hrtime();if(a.o){var d=b.output=a.o;try{fs$$module$temp$js$source$nodeJS$command.realpathSync(d)}catch(e){platform$$module$temp$js$source$nodeJS$command.writeFileSync(new URL$$module$temp$js$source$nodeJS$command(filepathToUri$$module$temp$js$source$nodeJS$command(d)),"")}b.baseOutputURI=filepathToUri$$module$temp$js$source$nodeJS$command(d);b.destination="file"}else b.destination="stdout",b.baseOutputURI=
filepathToUri$$module$temp$js$source$nodeJS$command(process.cwd());c&&(b.logLevel=2);if(a.s){var f=a.s;/^(http:|https:|file:)/.test(f)?b.sourceFileLocaton=f:b.sourceFileName=filepathToUri$$module$temp$js$source$nodeJS$command(f).toString()}a.it&&(c&&log$$module$temp$js$source$nodeJS$command("Initial template: "+a.it),b.initialTemplate=a.it);a.im&&(c&&log$$module$temp$js$source$nodeJS$command("Initial mode: "+a.im),b.initialMode=a.im);c&&a.o&&log$$module$temp$js$source$nodeJS$command("Writing to "+
filepathToUri$$module$temp$js$source$nodeJS$command(a.o));var k=SaxonJS.transform(b,"async");k=k["catch"](function(a){quit$$module$temp$js$source$nodeJS$command("Transformation failed: "+(a instanceof SaxonJS.XError?a.getMessage():a),2)});c&&(k=k.then(function(){var a=process.hrtime(g);console.warn("\nExecution time: %d.%ds",a[0],Math.floor(a[1]/1E6));a=process.memoryUsage().heapUsed/1024/1024;console.warn("Memory used: "+Math.round(100*a)/100+"Mb")}));return k}catch(e){quit$$module$temp$js$source$nodeJS$command(e instanceof
SaxonJS.XError?e.getMessage():e,2)}}
function main$$module$temp$js$source$nodeJS$command(){var a=argv$$module$temp$js$source$nodeJS$command.slice(2),b=CommandLine$$module$temp$js$source$nodeJS$commandLineOptions.newCLOptions();try{b.setActualOptions(a)}catch(l){quit$$module$temp$js$source$nodeJS$command(l instanceof SaxonJS.XError?l.getMessage():l,2)}var c=b.actualOptions,g=b.extraOptions,d=new TransformOptions$$module$temp$js$source$nodeJS$command;try{a.forEach(function(a){/[=-]/g.test(a)||badUsage$$module$temp$js$source$nodeJS$command("Invalid command line input: "+a)});
var f=getParams$$module$temp$js$source$nodeJS$command(a),k=getSerializationParams$$module$temp$js$source$nodeJS$command(a),e=31536E6<Date.now()-Date.parse(SaxonJS.getProcessorInfo().releaseDate);if(c["?"])badUsage$$module$temp$js$source$nodeJS$command("");else{var h=c.t,q=c.ns,n=c.tp,r=c.co;if(h||e){var t=SaxonJS.getProcessorInfo();log$$module$temp$js$source$nodeJS$command(t.productName+" "+t.productVersion+" from Saxonica "+(e?" (*** NO LONGER SUPPORTED ***)":""));log$$module$temp$js$source$nodeJS$command("Node.js version "+
process.version)}c.xsl||quit$$module$temp$js$source$nodeJS$command("Saxon requires a stylesheet as -xsl: argument",2);a={traceProgress:!!n,timing:!!h};a.extraOptions=g;r&&(a[r]=!0);q&&f.inSituPut(SaxonJS.XS.QName.fromEQName("Q{}ns"),[SaxonJS.XS.string.fromString(q)]);var p=compile$$module$temp$js$source$nodeJS$command(c,a,d,f,k);c["export"]&&(p=p.then(function(a){return platform$$module$temp$js$source$nodeJS$command.writeFileAsync(new URL$$module$temp$js$source$nodeJS$command(filepathToUri$$module$temp$js$source$nodeJS$command(c["export"])),
a.stylesheetText,"utf8")}).then(function(a){return new Promise(function(b,d){h&&log$$module$temp$js$source$nodeJS$command("Stylesheet exported to SEF file "+getPathToFile$$module$temp$js$source$nodeJS$command(c["export"]));b(a)})}));var m=p.then(function(a){if(c.nogo)exit$$module$temp$js$source$nodeJS$command();else return new Promise(function(b,c){b(a)})});if(!c.nogo){if(c.master){var u=platform$$module$temp$js$source$nodeJS$command.readFile(c.master),v=platform$$module$temp$js$source$nodeJS$command.parseXmlFromString(u);
d.masterDocument=v}m=m.then(function(a){d.stylesheetParams=f;d.outputProperties=k;d.extraOptions=g;return executeTransformation$$module$temp$js$source$nodeJS$command(c,d,h)}).then(function(a){return new Promise(function(a,b){h&&!failed$$module$temp$js$source$nodeJS$command&&log$$module$temp$js$source$nodeJS$command("Transformation complete ");a()})})}m=m["catch"](function(a){return quit$$module$temp$js$source$nodeJS$command(a instanceof SaxonJS.XError?a.getMessage():a,2)});d.masterDocument&&(m=m.then(function(){if(!failed$$module$temp$js$source$nodeJS$command){var a=
SaxonJS.serialize(d.masterDocument,{method:"xml"});return fs$$module$temp$js$source$nodeJS$command.promises.writeFile(c.master,a)}}));m["finally"](function(){exit$$module$temp$js$source$nodeJS$command()})}}catch(l){quit$$module$temp$js$source$nodeJS$command(l instanceof SaxonJS.XError?l.getMessage():l,2)}}
function badUsage$$module$temp$js$source$nodeJS$command(a){""!==a&&console.error(a);log$$module$temp$js$source$nodeJS$command("Usage: see http://www.saxonica.com/saxon-js/documentation/index.html#!nodejs/command-line");var b=CommandLine$$module$temp$js$source$nodeJS$commandLineOptions.newCLOptions();log$$module$temp$js$source$nodeJS$command("Options available:"+b.displayPermittedOptions());log$$module$temp$js$source$nodeJS$command("Use -XYZ:? for details of option XYZ");log$$module$temp$js$source$nodeJS$command("Params: ");
log$$module$temp$js$source$nodeJS$command("  param=value           Set stylesheet string parameter");log$$module$temp$js$source$nodeJS$command("  +param=filename       Set stylesheet document parameter");log$$module$temp$js$source$nodeJS$command("  ?param=expression     Set stylesheet parameter using XPath");log$$module$temp$js$source$nodeJS$command("  !param=value          Set serialization parameter");log$$module$temp$js$source$nodeJS$command("  (bindings and values containing punctuation may need to be quoted in some command shells,");
log$$module$temp$js$source$nodeJS$command('   e.g. in PowerShell:  "{NS}key=val" ?range="1 to 20" )');""===a?exit$$module$temp$js$source$nodeJS$command():exit$$module$temp$js$source$nodeJS$command(2)}main$$module$temp$js$source$nodeJS$command();(function wait(){finished$$module$temp$js$source$nodeJS$command||setTimeout(wait,100)})();var module$temp$js$source$nodeJS$command={};}).call(this);
